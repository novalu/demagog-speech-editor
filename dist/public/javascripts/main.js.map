{"version":3,"sources":["../../../public/javascripts/main.js"],"names":["storage","setSaveButtonState","state","button","$","removeAttr","css","addClass","removeClass","attr","setRemoveButtonState","existSavedPosition","id","savedStart","_","get","savedEnd","undefined","onStatementClick","set","exist","reloadStatements","each","index","statement","saveExist","originalText","text","preSelectionElem","first","selectionElem","postSelectionElem","preSelectionText","substring","selectionText","postSelectionText","length","onSaveStatementPositionClick","event","preventDefault","range","getSelection","getRangeAt","start","startOffset","end","endOffset","classes","startContainer","parentElement","classList","isPreSelection","contains","isSelection","isPostSelection","startPositionInOriginal","toString","endPositionInOriginal","rnOccurrencesToStart","substr","match","RegExp","start2","rnOccurrencesToEnd","end2","fragment","currentId","onRemoveStatementPositionClick","unset","initSaveStatementPositionButton","mousedown","initRemoveStatementPositionButton","isTextSelected","rangeCount","firstRange","selectedCount","checkSaveButtonState","isStatementSelected","isTextSelectedVar","existSavedPositionVar","initTextHandlers","preSelection","selection","postSelection","content","body","click","mousemove","mouseup","serializeData","data","savedStart2","savedEnd2","savedFragment","push","jsonToSend","JSON","stringify","submit","initGenerateJsonButton","restoreStatements","serializedJson","json","parse","forEach","initHandlers","onDocumentReady","document","ready"],"mappings":"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","file":"main.js","sourcesContent":["let storage = {};\n\nfunction setSaveButtonState(state) {\n  const button = $(\"#save-statement-position\");\n  if (state) {\n    button.removeAttr(\"disabled\");\n    button.css(\"cursor\", \"pointer\");\n    button.addClass(\"btn-success\");\n    button.removeClass(\"btn-secondary\");\n  } else {\n    button.attr(\"disabled\", \"disabled\");\n    button.css(\"cursor\", \"default\");\n    button.removeClass(\"btn-success\");\n    button.addClass(\"btn-secondary\");\n  }\n}\n\nfunction setRemoveButtonState(state) {\n  const button = $(\"#remove-statement-position\");\n  if (state) {\n    button.removeAttr(\"disabled\");\n    button.css(\"cursor\", \"pointer\");\n    button.addClass(\"btn-danger\");\n    button.removeClass(\"btn-secondary\");\n  } else {\n    button.attr(\"disabled\", \"disabled\");\n    button.css(\"cursor\", \"default\");\n    button.removeClass(\"btn-danger\");\n    button.addClass(\"btn-secondary\");\n  }\n}\n\nfunction existSavedPosition(id) {\n  const savedStart = _.get(storage, `s${id}.start`);\n  const savedEnd = _.get(storage, `s${id}.end`);\n  return savedStart !== undefined && savedEnd !== undefined;\n}\n\nfunction onStatementClick() {\n  const id = $(this).attr(\"data-statement-id\");\n  _.set(storage, \"current-id\", id);\n\n  setSaveButtonState(false);\n\n  const exist = existSavedPosition(id);\n  setRemoveButtonState(exist);\n\n  reloadStatements();\n}\n\nfunction reloadStatements() {\n  $(\".statement\").each(function(index, statement) {\n\n    const id = $(statement).attr(\"data-statement-id\");\n    const savedStart = _.get(storage, `s${id}.start`);\n    const savedEnd = _.get(storage, `s${id}.end`);\n    const saveExist = savedStart !== undefined && savedEnd !== undefined;\n\n    if (saveExist) {\n      $(statement).addClass(\"statement-saved\");\n    } else {\n      $(statement).removeClass(\"statement-saved\");\n    }\n\n    if (_.get(storage, \"current-id\") === id) {\n      $(statement).addClass(\"statement-selected\");\n\n      const originalText = $(\"#speech-original\").text();\n\n      const preSelectionElem = $(\".pre-selection\").first();\n      const selectionElem = $(\".selection\").first();\n      const postSelectionElem = $(\".post-selection\").first();\n\n      if (saveExist) {\n        const preSelectionText = originalText.substring(0, savedStart);\n        preSelectionElem.text(preSelectionText);\n\n        const selectionText = originalText.substring(savedStart, savedEnd);\n        selectionElem.text(selectionText);\n\n        const postSelectionText = originalText.substring(savedEnd, originalText.length);\n        postSelectionElem.text(postSelectionText);\n      } else {\n        preSelectionElem.text(originalText);\n        selectionElem.text(\"\");\n        postSelectionElem.text(\"\");\n      }\n\n    } else {\n      $(statement).removeClass(\"statement-selected\")\n    }\n\n  });\n}\n\nfunction onSaveStatementPositionClick(event) {\n  event.preventDefault();\n\n  const range = getSelection().getRangeAt(0);\n  const start = range.startOffset;\n  const end = range.endOffset;\n  const classes = range.startContainer.parentElement.classList;\n  const isPreSelection = classes.contains(\"pre-selection\");\n  const isSelection = classes.contains(\"selection\");\n  const isPostSelection = classes.contains(\"post-selection\");\n\n  let startPositionInOriginal = 0;\n  if (isPreSelection) {\n    startPositionInOriginal = start\n  } else if (isSelection) {\n    startPositionInOriginal = $(\".pre-selection\").text().toString().length + start;\n  } else if (isPostSelection) {\n    startPositionInOriginal = $(\".pre-selection\").text().toString().length + $(\".selection\").text().toString().length + start;\n  }\n  let endPositionInOriginal = startPositionInOriginal + (end - start);\n\n  let originalText = $(\"#speech-original\").text().toString();\n  let rnOccurrencesToStart = (originalText.substr(0, startPositionInOriginal).match(new RegExp(\"\\n|\\r\", \"g\")) || []).length;\n  let start2 = startPositionInOriginal + rnOccurrencesToStart;\n  let rnOccurrencesToEnd = (originalText.substr(0, endPositionInOriginal).match(new RegExp(\"\\n|\\r\", \"g\")) || []).length;\n  let end2 = endPositionInOriginal + rnOccurrencesToEnd;\n\n  let fragment = originalText.substr(startPositionInOriginal, (endPositionInOriginal - startPositionInOriginal));\n\n  const currentId = _.get(storage, \"current-id\");\n  _.set(storage, `s${currentId}.start`, startPositionInOriginal.toString());\n  _.set(storage, `s${currentId}.end`, endPositionInOriginal.toString());\n  _.set(storage, `s${currentId}.start2`, start2.toString());\n  _.set(storage, `s${currentId}.end2`, end2.toString());\n  _.set(storage, `s${currentId}.fragment`, fragment);\n\n  setRemoveButtonState(true);\n\n  reloadStatements();\n}\n\nfunction onRemoveStatementPositionClick(event) {\n  event.preventDefault();\n\n  const currentId = _.get(storage, \"current-id\");\n  _.unset(storage, `s${currentId}.start`);\n  _.unset(storage, `s${currentId}.end`);\n\n  setRemoveButtonState(false);\n\n  reloadStatements();\n}\n\nfunction initSaveStatementPositionButton() {\n  const button = $(\"#save-statement-position\");\n  setSaveButtonState(false);\n  button.mousedown(onSaveStatementPositionClick);\n}\n\nfunction initRemoveStatementPositionButton() {\n  const button = $(\"#remove-statement-position\");\n  setRemoveButtonState(false);\n  button.mousedown(onRemoveStatementPositionClick);\n}\n\nfunction isTextSelected() {\n  const range = getSelection();\n  if (range !== null && range.rangeCount > 0) {\n    const firstRange = range.getRangeAt(0);\n    const classes = firstRange.startContainer.parentElement.classList;\n    const isPreSelection = classes.contains(\"pre-selection\");\n    const isSelection = classes.contains(\"selection\");\n    const isPostSelection = classes.contains(\"post-selection\");\n    const selectedCount = firstRange.endOffset - firstRange.startOffset;\n    return selectedCount > 0 && (isPreSelection || isSelection || isPostSelection);\n  }\n  return false;\n}\n\nfunction checkSaveButtonState(event) {\n  const currentId = _.get(storage, \"current-id\");\n  const isStatementSelected = currentId !== undefined;\n\n  const isTextSelectedVar = isTextSelected();\n\n  const existSavedPositionVar = existSavedPosition(currentId);\n\n  setSaveButtonState(isStatementSelected && isTextSelectedVar && !existSavedPositionVar);\n}\n\nfunction initTextHandlers() {\n  let preSelection = $(\".pre-selection\");\n  let selection = $(\".selection\");\n  let postSelection = $(\".post-selection\");\n  let content = $(\"#content\");\n  let body = $(\"body\");\n\n  body.click(checkSaveButtonState);\n\n  content.mousemove(checkSaveButtonState);\n  content.mousedown(checkSaveButtonState);\n  content.click(checkSaveButtonState);\n  content.mouseup(checkSaveButtonState);\n\n  preSelection.mousedown(checkSaveButtonState);\n  preSelection.click(checkSaveButtonState);\n  preSelection.mouseup(checkSaveButtonState);\n\n  selection.mousedown(checkSaveButtonState);\n  selection.click(checkSaveButtonState);\n  selection.mouseup(checkSaveButtonState);\n\n  postSelection.mousedown(checkSaveButtonState);\n  postSelection.click(checkSaveButtonState);\n  postSelection.mouseup(checkSaveButtonState);\n}\n\nfunction serializeData() {\n  let data = [];\n  $(\".statement\").each(function(index, statement) {\n    const id = $(statement).attr(\"data-statement-id\");\n    const savedStart = _.get(storage, `s${id}.start`);\n    const savedEnd = _.get(storage, `s${id}.end`);\n    const savedStart2 = _.get(storage, `s${id}.start2`);\n    const savedEnd2 = _.get(storage, `s${id}.end2`);\n    const savedFragment = _.get(storage, `s${id}.fragment`);\n    if (savedStart !== undefined && savedEnd !== undefined && savedStart2 !== undefined && savedEnd2 !== undefined && savedFragment !== undefined) {\n      data.push({\n        \"id\": id,\n        \"start\": savedStart,\n        \"end\": savedEnd,\n        \"start2\": savedStart2,\n        \"end2\": savedEnd2,\n        \"fragment\": savedFragment\n      })\n    }\n  });\n  let jsonToSend = JSON.stringify(data);\n  $(\"#data\").attr(\"value\", jsonToSend);\n  $(\"#submit\").submit();\n}\n\nfunction initGenerateJsonButton() {\n  $(\"#generate-json\").click(function() {\n    serializeData();\n  })\n}\n\nfunction restoreStatements() {\n  const serializedJson = $(\"#data\").attr(\"value\");\n  if (serializedJson) {\n    const json = JSON.parse(serializedJson);\n    _.forEach(json, function (statement) {\n      _.set(storage, `s${statement.id}.start`, statement.start);\n      _.set(storage, `s${statement.id}.end`, statement.end);\n      _.set(storage, `s${statement.id}.start2`, statement.start2);\n      _.set(storage, `s${statement.id}.end2`, statement.end2);\n      _.set(storage, `s${statement.id}.fragment`, statement.fragment);\n    });\n  }\n  reloadStatements();\n}\n\nfunction initHandlers() {\n  $(\".statement\").mousedown(onStatementClick);\n  initTextHandlers();\n  initSaveStatementPositionButton();\n  initRemoveStatementPositionButton();\n  initGenerateJsonButton();\n}\n\nfunction onDocumentReady() {\n  storage = {};\n  restoreStatements();\n  initHandlers();\n}\n\n$(document).ready(onDocumentReady);\n\n"]}